<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‡ªå‹•åˆ·æ–°ç‹€æ…‹æª¢æŸ¥</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .status-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 600px;
            margin: 0 auto;
        }
        .status-item {
            margin: 15px 0;
            padding: 10px;
            border-left: 4px solid #007acc;
            background: #f8f9fa;
        }
        .status-label {
            font-weight: bold;
            color: #333;
        }
        .status-value {
            color: #666;
            margin-left: 10px;
        }
        .refresh-btn {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        .refresh-btn:hover {
            background: #005a9e;
        }
        .log-area {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="status-container">
        <h1>ğŸ”„ è‡ªå‹•åˆ·æ–°ç‹€æ…‹æª¢æŸ¥</h1>
        
        <div class="status-item">
            <span class="status-label">è‡ªå‹•åˆ·æ–°é–‹é—œç‹€æ…‹:</span>
            <span class="status-value" id="toggleStatus">æª¢æŸ¥ä¸­...</span>
        </div>
        
        <div class="status-item">
            <span class="status-label">isAutoRefreshEnabled è®Šé‡:</span>
            <span class="status-value" id="enabledStatus">æª¢æŸ¥ä¸­...</span>
        </div>
        
        <div class="status-item">
            <span class="status-label">å®šæ™‚å™¨ç‹€æ…‹:</span>
            <span class="status-value" id="timerStatus">æª¢æŸ¥ä¸­...</span>
        </div>
        
        <div class="status-item">
            <span class="status-label">æœ€å¾Œæ›´æ–°æ™‚é–“:</span>
            <span class="status-value" id="lastUpdateStatus">æª¢æŸ¥ä¸­...</span>
        </div>
        
        <div class="status-item">
            <span class="status-label">é é¢å¯è¦‹æ€§:</span>
            <span class="status-value" id="visibilityStatus">æª¢æŸ¥ä¸­...</span>
        </div>
        
        <button class="refresh-btn" onclick="checkStatus()">ğŸ”„ é‡æ–°æª¢æŸ¥</button>
        <button class="refresh-btn" onclick="openMainPage()">ğŸ  æ‰“é–‹ä¸»é é¢</button>
        <button class="refresh-btn" onclick="toggleAutoRefresh()">âš¡ åˆ‡æ›è‡ªå‹•åˆ·æ–°</button>
        <button class="refresh-btn" onclick="clearLog()">ğŸ—‘ï¸ æ¸…é™¤æ—¥èªŒ</button>
        
        <div class="log-area" id="logArea"></div>
    </div>
    
    <script>
        function log(message) {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            logArea.innerHTML += `[${timestamp}] ${message}<br>`;
            logArea.scrollTop = logArea.scrollHeight;
        }
        
        function checkStatus() {
            log('é–‹å§‹æª¢æŸ¥è‡ªå‹•åˆ·æ–°ç‹€æ…‹...');
            
            // å˜—è©¦é€šéiframeæˆ–æ–°çª—å£æª¢æŸ¥ä¸»é é¢ç‹€æ…‹
            try {
                // æª¢æŸ¥æ˜¯å¦åœ¨ä¸»é é¢ä¸­
                if (window.location.pathname.includes('index.html') || window.location.pathname === '/') {
                    log('ç•¶å‰åœ¨ä¸»é é¢ï¼Œç›´æ¥æª¢æŸ¥ç‹€æ…‹');
                    checkMainPageStatus();
                } else {
                    log('ç•¶å‰åœ¨ç‹€æ…‹æª¢æŸ¥é é¢ï¼Œéœ€è¦æª¢æŸ¥ä¸»é é¢ç‹€æ…‹');
                    checkViaMainPage();
                }
            } catch (error) {
                log(`æª¢æŸ¥ç‹€æ…‹æ™‚ç™¼ç”ŸéŒ¯èª¤: ${error.message}`);
            }
        }
        
        function checkMainPageStatus() {
            // æª¢æŸ¥é–‹é—œç‹€æ…‹
            const toggle = document.getElementById('autoRefreshToggle');
            const toggleStatus = toggle ? toggle.checked : 'é–‹é—œå…ƒç´ ä¸å­˜åœ¨';
            document.getElementById('toggleStatus').textContent = toggleStatus;
            log(`é–‹é—œç‹€æ…‹: ${toggleStatus}`);
            
            // æª¢æŸ¥å…¨å±€è®Šé‡
            const isEnabled = typeof window.isAutoRefreshEnabled !== 'undefined' ? 
                window.isAutoRefreshEnabled : 'è®Šé‡ä¸å­˜åœ¨';
            document.getElementById('enabledStatus').textContent = isEnabled;
            log(`isAutoRefreshEnabled: ${isEnabled}`);
            
            // æª¢æŸ¥å®šæ™‚å™¨
            const timerStatus = typeof window.autoRefreshInterval !== 'undefined' ? 
                (window.autoRefreshInterval ? `é‹è¡Œä¸­ (ID: ${window.autoRefreshInterval})` : 'å·²åœæ­¢') : 
                'è®Šé‡ä¸å­˜åœ¨';
            document.getElementById('timerStatus').textContent = timerStatus;
            log(`å®šæ™‚å™¨ç‹€æ…‹: ${timerStatus}`);
            
            // æª¢æŸ¥æœ€å¾Œæ›´æ–°æ™‚é–“
            const lastUpdate = typeof window.lastUpdateTime !== 'undefined' ? 
                (window.lastUpdateTime ? new Date(window.lastUpdateTime).toLocaleString() : 'æœªè¨­ç½®') : 
                'è®Šé‡ä¸å­˜åœ¨';
            document.getElementById('lastUpdateStatus').textContent = lastUpdate;
            log(`æœ€å¾Œæ›´æ–°æ™‚é–“: ${lastUpdate}`);
            
            // æª¢æŸ¥é é¢å¯è¦‹æ€§
            const visibility = document.hidden ? 'éš±è—' : 'å¯è¦‹';
            document.getElementById('visibilityStatus').textContent = visibility;
            log(`é é¢å¯è¦‹æ€§: ${visibility}`);
            
            log('ç‹€æ…‹æª¢æŸ¥å®Œæˆ!');
        }
        
        function checkViaMainPage() {
            // å‰µå»ºéš±è—çš„iframeä¾†æª¢æŸ¥ä¸»é é¢ç‹€æ…‹
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = '/index.html';
            
            iframe.onload = function() {
                try {
                    const iframeWindow = iframe.contentWindow;
                    
                    // æª¢æŸ¥é–‹é—œç‹€æ…‹
                    const toggle = iframeWindow.document.getElementById('autoRefreshToggle');
                    const toggleStatus = toggle ? toggle.checked : 'é–‹é—œå…ƒç´ ä¸å­˜åœ¨';
                    document.getElementById('toggleStatus').textContent = toggleStatus;
                    log(`é–‹é—œç‹€æ…‹: ${toggleStatus}`);
                    
                    // æª¢æŸ¥å…¨å±€è®Šé‡
                    const isEnabled = typeof iframeWindow.isAutoRefreshEnabled !== 'undefined' ? 
                        iframeWindow.isAutoRefreshEnabled : 'è®Šé‡ä¸å­˜åœ¨';
                    document.getElementById('enabledStatus').textContent = isEnabled;
                    log(`isAutoRefreshEnabled: ${isEnabled}`);
                    
                    // æª¢æŸ¥å®šæ™‚å™¨
                    const timerStatus = typeof iframeWindow.autoRefreshInterval !== 'undefined' ? 
                        (iframeWindow.autoRefreshInterval ? `é‹è¡Œä¸­ (ID: ${iframeWindow.autoRefreshInterval})` : 'å·²åœæ­¢') : 
                        'è®Šé‡ä¸å­˜åœ¨';
                    document.getElementById('timerStatus').textContent = timerStatus;
                    log(`å®šæ™‚å™¨ç‹€æ…‹: ${timerStatus}`);
                    
                    // æª¢æŸ¥æœ€å¾Œæ›´æ–°æ™‚é–“
                    const lastUpdate = typeof iframeWindow.lastUpdateTime !== 'undefined' ? 
                        (iframeWindow.lastUpdateTime ? new Date(iframeWindow.lastUpdateTime).toLocaleString() : 'æœªè¨­ç½®') : 
                        'è®Šé‡ä¸å­˜åœ¨';
                    document.getElementById('lastUpdateStatus').textContent = lastUpdate;
                    log(`æœ€å¾Œæ›´æ–°æ™‚é–“: ${lastUpdate}`);
                    
                    log('é€šéiframeæª¢æŸ¥å®Œæˆ!');
                    
                } catch (error) {
                    log(`ç„¡æ³•è¨ªå•iframeå…§å®¹ï¼Œå¯èƒ½æ˜¯è·¨åŸŸé™åˆ¶: ${error.message}`);
                    showManualInstructions();
                } finally {
                    document.body.removeChild(iframe);
                }
            };
            
            iframe.onerror = function() {
                log('ç„¡æ³•è¼‰å…¥ä¸»é é¢iframe');
                showManualInstructions();
                document.body.removeChild(iframe);
            };
            
            document.body.appendChild(iframe);
            
            // æª¢æŸ¥ç•¶å‰é é¢å¯è¦‹æ€§
            const visibility = document.hidden ? 'éš±è—' : 'å¯è¦‹';
            document.getElementById('visibilityStatus').textContent = visibility;
            log(`ç•¶å‰é é¢å¯è¦‹æ€§: ${visibility}`);
        }
        
        function showManualInstructions() {
            document.getElementById('toggleStatus').textContent = 'éœ€è¦æ‰‹å‹•æª¢æŸ¥';
            document.getElementById('enabledStatus').textContent = 'éœ€è¦æ‰‹å‹•æª¢æŸ¥';
            document.getElementById('timerStatus').textContent = 'éœ€è¦æ‰‹å‹•æª¢æŸ¥';
            document.getElementById('lastUpdateStatus').textContent = 'éœ€è¦æ‰‹å‹•æª¢æŸ¥';
            
            log('=== æ‰‹å‹•æª¢æŸ¥æŒ‡å— ===');
            log('1. æ‰“é–‹ä¸»é é¢ (index.html)');
            log('2. æŒ‰F12æ‰“é–‹é–‹ç™¼è€…å·¥å…·');
            log('3. åœ¨Consoleä¸­è¼¸å…¥ä»¥ä¸‹å‘½ä»¤:');
            log('   console.log("è‡ªå‹•åˆ·æ–°ç‹€æ…‹:", isAutoRefreshEnabled);');
            log('   console.log("å®šæ™‚å™¨ID:", autoRefreshInterval);');
            log('   console.log("é–‹é—œç‹€æ…‹:", document.getElementById("autoRefreshToggle")?.checked);');
            log('   console.log("æœ€å¾Œæ›´æ–°:", lastUpdateTime ? new Date(lastUpdateTime) : "æœªè¨­ç½®");');
        }
        
        function toggleAutoRefresh() {
            if (typeof window.toggleAutoRefresh === 'function') {
                const currentState = window.isAutoRefreshEnabled;
                window.toggleAutoRefresh(!currentState);
                log(`æ‰‹å‹•åˆ‡æ›è‡ªå‹•åˆ·æ–°: ${currentState} -> ${!currentState}`);
                setTimeout(checkStatus, 500);
            } else {
                log('éŒ¯èª¤: toggleAutoRefresh å‡½æ•¸ä¸å­˜åœ¨');
            }
        }
        
        function openMainPage() {
            log('æ­£åœ¨æ‰“é–‹ä¸»é é¢...');
            window.open('/index.html', '_blank');
        }
        
        function clearLog() {
            document.getElementById('logArea').innerHTML = '';
        }
        
        // é é¢è¼‰å…¥æ™‚è‡ªå‹•æª¢æŸ¥
        window.addEventListener('load', () => {
            log('é é¢è¼‰å…¥å®Œæˆï¼Œé–‹å§‹æª¢æŸ¥ç‹€æ…‹...');
            setTimeout(checkStatus, 1000);
        });
        
        // ç›£è½é é¢å¯è¦‹æ€§è®ŠåŒ–
        document.addEventListener('visibilitychange', () => {
            log(`é é¢å¯è¦‹æ€§è®ŠåŒ–: ${document.hidden ? 'éš±è—' : 'é¡¯ç¤º'}`);
            checkStatus();
        });
    </script>
</body>
</html>